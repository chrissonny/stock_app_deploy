# =========================================================
# 老王實戰版 V3 - 參數配置 (重構版)
# 核心升級:
# 1. 補全 MA_SLOPE_THRESHOLD (斜率濾網)
# 2. 新增可調整的賣出參數
# 3. 改善程式可維護性
# =========================================================
from datetime import datetime, timedelta

# =========================================================
# 時間範圍設定 (自動抓取 3 年資料)
# =========================================================
today = datetime.today()
start_date_obj = today - timedelta(days=1095)  # 3年 = 1095天
START_DATE_STR = start_date_obj.strftime("%Y-%m-%d")
END_DATE_STR = today.strftime("%Y-%m-%d")

# =========================================================
# 股票清單
# =========================================================
STOCK_LIST_TEXT = """
2330
2317
2344
2454
2603
2881
2882
2449
"""

DEFAULT_TICKERS = [
    f"{x}.TW" if not x.endswith(".TW") else x
    for x in STOCK_LIST_TEXT.split()
    if x.strip()
]

# =========================================================
# 股票類型分類 (決定生命線選擇)
# =========================================================
TICKERS_CONFIG = {
    "2330.TW": "WEIGHT",      # 台積電 - 權值股
    "2317.TW": "WEIGHT",      # 鴻海 - 權值股
    "2881.TW": "FINANCE",     # 富邦金 - 金融股
    "2882.TW": "FINANCE",     # 國泰金 - 金融股
    "2449.TW": "MOMENTUM",    # 京元電 - 動能股
}

# =========================================================
# 主參數字典
# =========================================================
P = {
    # --- 時間設定 ---
    "START": START_DATE_STR,
    "END": END_DATE_STR,

    # --- 均線參數 ---
    "MA5": 5,
    "MA10": 10,
    "MA20": 20,
    "MA60": 60,
    "MA240": 240,

    # --- 買進參數 ---
    "MA_SLOPE_THRESHOLD": 0.005,   # 均線斜率門檻 (0.5%)
    "BIGVOL_MULT": 2.0,            # 爆大量倍數 (量能 > 均量 2 倍)
    "BIG_RED_BODY_PCT": 0.03,      # 長紅實體漲幅 (3%)
    "GAP_UP_PCT": 0.005,           # 跳空幅度 (0.5%)

    # --- 賣出參數 (新增) ---
    "BIAS_THRESHOLD": 0.15,        # 乖離率閾值 (15% 視為過熱)
    "STOP_BUFFER_PCT": 0.015,      # 停損緩衝 (1.5%)
    "HARD_STOP_PCT": 0.05,         # 硬停損幅度 (季線下 5%)
    "EXIT_COOLDOWN_DAYS": 5,       # 出場冷卻期 (天)

    # --- 評分參數 ---
    "SCORE_BUY_THRESHOLD": 70,     # 買進評分門檻
    "SCORE_SELL_THRESHOLD": 30,    # 賣出評分門檻

    # --- 交易成本 ---
    "FEE_BUY": 0.001425,           # 買進手續費 (0.1425%)
    "FEE_SELL": 0.004425,          # 賣出手續費 + 證交稅 (0.4425%)

    # --- 爆量相關 ---
    "BIGVOL_VALID_DAYS": 60,       # 爆量支撐有效期 (天)

    # --- 技術指標參數 ---
    "VOL_MA": 20,                  # 量能均線
    "ATR_N": 14,                   # ATR 週期
    "KD_N": 9,                     # KD 週期
    "RSI_N": 14,                   # RSI 週期
    "MACD_FAST": 12,               # MACD 快線
    "MACD_SLOW": 26,               # MACD 慢線
    "MACD_SIGNAL": 9,              # MACD 訊號線
}

# =========================================================
# 參數說明 (可用於文件生成)
# =========================================================
PARAM_DESCRIPTIONS = {
    "MA_SLOPE_THRESHOLD": "均線斜率門檻,低於此值視為趨勢不明確",
    "BIAS_THRESHOLD": "乖離率過高閾值,超過視為過熱需要獲利了結",
    "STOP_BUFFER_PCT": "跌破生命線的緩衝空間,避免雜訊誤觸發",
    "HARD_STOP_PCT": "無條件停損幅度,跌破此值立即出場",
    "EXIT_COOLDOWN_DAYS": "出場後冷卻天數,避免頻繁進出",
}
